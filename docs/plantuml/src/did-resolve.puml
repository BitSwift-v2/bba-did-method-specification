@startuml
skinparam BoxPadding 15
skinparam ParticipantPadding 15


participant "Verifier" as VER
participant "DID Resolver" as RES
box "ARDOR Blockchain" #WhiteSmoke
    participant "Account" as ATTE
    participant "New Account" as NATTE
    participant "Tx Resolver" as TXR
    participant "Cloud Storage" as STR
end box



VER -> RES: read DID (did:bba:<txh_d>)
|||


== DID Attestation Parsing ==

loop
    alt is first iteration
        RES -> TXR: get transaction (txh_d)
        RES -> RES: check if transaction is\nself-set DID attestation
    else
        ' RES -> RES: store account name
        RES -> NATTE: get initial self-set DID attestation
        RES -> RES: treat new account\nas current account
    end

    RES -> RES: check if attestation is active
    RES -> ATTE: get self-set\nDID attestations

    loop over found attestations
        RES -> RES: treat found attestation\nas current attestation
        alt is attestation deprecated
            RES -> RES: break loop
        else is attestation deactivated
            RES -> RES: stop DID resolution
        end
    end
    alt is attestation active
        RES -> RES: break loop
    end
end
|||


== DID Document Template Retrieval\n(Ardor Cloud Storage) ==

RES -> RES: extract cloud storage tx hash (txh_s)
RES -> STR: get did document template (txh_s)
RES -> RES: check if did document template is self-set\n(by one of the found DID Controllers)
|||


== DID Document Preparation ==

RES -> RES: add DID informations to the\nDID Document Template
RES -> VER: return DID Document


@enduml